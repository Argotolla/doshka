<script>
let draggedTask = null;

// створення задачі
function createTask(text) {
  const task = document.createElement('div');
  task.className = 'task';
  task.draggable = true;

  // текст
  const textNode = document.createTextNode(text);
  task.appendChild(textNode);

  // кнопка видалення
  const del = document.createElement('button');
  del.className = 'delete-btn';
  del.textContent = '×';
  del.onclick = (e) => {
    e.stopPropagation();
    task.remove();
    saveBoard();
  };
  task.appendChild(del);

  // drag events
  task.addEventListener('dragstart', () => draggedTask = task);
  task.addEventListener('dragend', () => {
    draggedTask = null;
    saveBoard();
  });

  return task;
}

// додавання задач
document.querySelectorAll('.add-task').forEach(container => {
  const input = container.querySelector('input');
  const button = container.querySelector('button');
  const tasksDiv = container.parentElement.querySelector('.tasks');

  button.addEventListener('click', () => {
    if(input.value.trim() !== '') {
      tasksDiv.appendChild(createTask(input.value.trim()));
      input.value = '';
      saveBoard();
    }
  });

  input.addEventListener('keypress', (e) => {
    if(e.key === 'Enter' && input.value.trim() !== '') {
      tasksDiv.appendChild(createTask(input.value.trim()));
      input.value = '';
      saveBoard();
    }
  });
});

// drag & drop для всіх колонок
document.querySelectorAll('.tasks').forEach(tasksDiv => {
  tasksDiv.addEventListener('dragover', e => e.preventDefault());

  tasksDiv.addEventListener('drop', e => {
    e.preventDefault();
    if(draggedTask) {
      tasksDiv.appendChild(draggedTask);
      saveBoard();
    }
  });
});

// збереження у LocalStorage
function saveBoard() {
  const board = {};
  document.querySelectorAll('.column').forEach(col => {
    const colId = col.id;
    const tasks = Array.from(col.querySelectorAll('.task')).map(t => t.firstChild.textContent);
    board[colId] = tasks;
  });
  localStorage.setItem('kanbanBoard', JSON.stringify(board));
}

// завантаження з LocalStorage
function loadBoard() {
  const board = JSON.parse(localStorage.getItem('kanbanBoard') || '{}');
  document.querySelectorAll('.column').forEach(col => {
    const colId = col.id;
    const tasksDiv = col.querySelector('.tasks');
    tasksDiv.innerHTML = '';
    if(board[colId]) {
      board[colId].forEach(text => tasksDiv.appendChild(createTask(text)));
    }
  });
}

loadBoard();
</script>
